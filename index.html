<!DOCTYPE html>
<html>
<head>
<style id="twitter-inject">
body a, body a:visited, body .timeline-Tweet-text a {
  color: #222222 !important;
}
body .timeline-Tweet-text a {
  font-style: italic;
}
body .timeline-Tweet:hover {
  background-color: transparent;
}
body .timeline-Tweet-text {
  color: #111111 !important;
  margin-left: 0 !important;
  float: left;
  clear: both;
}
body .timeline-Tweet-media {
  margin-left: 0 !important;
  margin-bottom: 0 !important;
}
/*
body .timeline-Tweet-text:before {
  content: "-";
  display: block;
  float: left;
  width: 100%;
  clear: both;
  margin-bottom: 6px;
  font-weight: bold;
}
*/
body .timeline-Tweet-author {
  float: left;
  width: 100%;
  padding-left: 0 !important;
}
body .TweetAuthor {
  float: left;
  height: 30px;
  margin-top: 20px;
  overflow: visible !important;
}
body .timeline-Tweet-brand {
  float: left !important;
  width: 100%;
  font-size: 30px;
}
body .TweetAuthor-screenName {
  color: #222222 !important;
  font-size: 24px !important;
  font-weight: bold;
}
body .TweetAuthor-name,
body .TweetAuthor-avatar,
body .timeline-Tweet-brand,
body .timeline-Tweet-actions,
body .timeline-Tweet-metadata,
body .TweetAuthor-verifiedBadge,
body .timeline-Tweet-retweetCredit {
  display: none;
}
body .timeline-TweetList-tweet {
  opacity: 1;
}
body .timeline-TweetList-tweet.top {
  position: absolute;
  transition: opacity 0.4s linear;
}
body .timeline-TweetList-tweet.hide {
  opacity: 0;
}
</style>
<style id="parentStyle">
body {
  margin: 0;
  padding: 0;
}
.version {
  color: #111111;
}
#custom-twitter-icon {
  fill: red;
  fill: #111111;
  width: 40px;
  height: 32.5px;
}
#timeline {
  opacity: 1;
  transition: opacity 0.4s linear;
}
#timeline.hide {
  opacity: 0;
}
</style>
<script>
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */
if("document" in self){if(!("classList" in document.createElement("_"))){(function(j){"use strict";if(!("Element" in j)){return}var a="classList",f="prototype",m=j.Element[f],b=Object,k=String[f].trim||function(){return this.replace(/^\s+|\s+$/g,"")},c=Array[f].indexOf||function(q){var p=0,o=this.length;for(;p<o;p++){if(p in this&&this[p]===q){return p}}return -1},n=function(o,p){this.name=o;this.code=DOMException[o];this.message=p},g=function(p,o){if(o===""){throw new n("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(o)){throw new n("INVALID_CHARACTER_ERR","String contains an invalid character")}return c.call(p,o)},d=function(s){var r=k.call(s.getAttribute("class")||""),q=r?r.split(/\s+/):[],p=0,o=q.length;for(;p<o;p++){this.push(q[p])}this._updateClassName=function(){s.setAttribute("class",this.toString())}},e=d[f]=[],i=function(){return new d(this)};n[f]=Error[f];e.item=function(o){return this[o]||null};e.contains=function(o){o+="";return g(this,o)!==-1};e.add=function(){var s=arguments,r=0,p=s.length,q,o=false;do{q=s[r]+"";if(g(this,q)===-1){this.push(q);o=true}}while(++r<p);if(o){this._updateClassName()}};e.remove=function(){var t=arguments,s=0,p=t.length,r,o=false,q;do{r=t[s]+"";q=g(this,r);while(q!==-1){this.splice(q,1);o=true;q=g(this,r)}}while(++s<p);if(o){this._updateClassName()}};e.toggle=function(p,q){p+="";var o=this.contains(p),r=o?q!==true&&"remove":q!==false&&"add";if(r){this[r](p)}if(q===true||q===false){return q}else{return !o}};e.toString=function(){return this.join(" ")};if(b.defineProperty){var l={get:i,enumerable:true,configurable:true};try{b.defineProperty(m,a,l)}catch(h){if(h.number===-2146823252){l.enumerable=false;b.defineProperty(m,a,l)}}}else{if(b[f].__defineGetter__){m.__defineGetter__(a,i)}}}(self))}else{(function(){var b=document.createElement("_");b.classList.add("c1","c2");if(!b.classList.contains("c2")){var c=function(e){var d=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(h){var g,f=arguments.length;for(g=0;g<f;g++){h=arguments[g];d.call(this,h)}}};c("add");c("remove")}b.classList.toggle("c3",false);if(b.classList.contains("c3")){var a=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(d,e){if(1 in arguments&&!this.contains(d)===!e){return e}else{return a.call(this,d)}}}b=null}())}};
</script>
</head>
<body>
<span class="version">test windows v20</span>
<div id="timeline" class="hide">
  <svg
    id="custom-twitter-icon"
    viewbox="0 0 2000 1625.36"
    width="2000"
    height="1625.36"
    version="1.1"
    xmlns="http://www.w3.org/2000/svg">
    <path d="m 1999.9999,192.4 c -73.58,32.64 -152.67,54.69 -235.66,64.61 84.7,-50.78 149.77,-131.19 180.41,-227.01 -79.29,47.03 -167.1,81.17 -260.57,99.57 C 1609.3399,49.82 1502.6999,0 1384.6799,0 c -226.6,0 -410.328,183.71 -410.328,410.31 0,32.16 3.628,63.48 10.625,93.51 -341.016,-17.11 -643.368,-180.47 -845.739,-428.72 -35.324,60.6 -55.5583,131.09 -55.5583,206.29 0,142.36 72.4373,267.95 182.5433,341.53 -67.262,-2.13 -130.535,-20.59 -185.8519,-51.32 -0.039,1.71 -0.039,3.42 -0.039,5.16 0,198.803 141.441,364.635 329.145,402.342 -34.426,9.375 -70.676,14.395 -108.098,14.395 -26.441,0 -52.145,-2.578 -77.203,-7.364 52.215,163.008 203.75,281.649 383.304,284.946 -140.429,110.062 -317.351,175.66 -509.5972,175.66 -33.1211,0 -65.7851,-1.949 -97.8828,-5.738 181.586,116.4176 397.27,184.359 628.988,184.359 754.732,0 1167.462,-625.238 1167.462,-1167.47 0,-17.79 -0.41,-35.48 -1.2,-53.08 80.1799,-57.86 149.7399,-130.12 204.7499,-212.41"/>
  </svg>
</div>
<script>
var timeline = document.getElementById('timeline');
var parentStyle = document.getElementById('parentStyle').sheet;
// destructure the search-(query-param)-string into variables with default values;
/*({
  account = 'thisplays2',
  timer = 4000,
  media = false,
  'number-of-tweets': number = 10,
  'primary-color': primary = 'b40b2b',
  'secundary-color': secundary = '111111',
  'body-padding': padding = '2em'
} = window.location.search.replace('?','').split('&').reduce((prev,next) => {
  var query = next.split('=');
  prev[query[0]] = query[1];
  return prev;
},{}));*/
var account = 'thisplays2';
var timer = 4000;
var media = false;
var number = 10;
var primary = 'b40b2b';
var secundary = '111111';
var padding = '2em';
var query = window.location.search.replace('?','').split('&');
for(var i=0; i<query.length; i++) {
  var params = query[i].split('=');
  switch(params[0]) {
    case 'account': account = params[1];
      break;
    case 'timer': timer = parseInt(params[1],10);
      break;
    case 'media': media = params[1];
      break;
    case 'number-of-tweets': number = params[1];
      break;
    case 'primary-color': primary = params[1];
      break;
    case 'secundary-color': secundary = params[1];
      break;
    case 'body-padding': padding = params[1];
      break;
  }
}

function addCSSRule(sheet, selector, rules, index) {
  if(index === undefined) {
    index = sheet.rules.length;
  }
  if('insertRule' in sheet) {
    sheet.insertRule(selector + ' {' + rules + '}', index);
  } else if('addRule' in sheet) {
    sheet.addRule(selector, rules, index);
  }
}
function replaceCSS(sheet, needle, replace) {
  for(var i=0; i<sheet.rules.length; i++) {
    var text = sheet.rules[i].cssText;
    console.log(text,needle);
    console.log(text.indexOf(needle));
    if(text.indexOf(needle)!==-1) {
      console.log(text);
      text = text.replace(needle,replace);
      console.log(text);
      sheet.removeRule(i);
      sheet.insertRule(text,i);
    }
  }
}
addCSSRule(parentStyle,'body','padding: '+decodeURIComponent(padding).replace(/"|'/ig,'')+';');
replaceCSS(parentStyle,'#111111','#'+primary);
replaceCSS(parentStyle,'#222222','#'+secundary);
window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = 'https://platform.twitter.com/widgets.js';
  fjs.parentNode.insertBefore(js, fjs);
  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };
  return t;
}(document, 'script', 'twitter-wjs'));
window.twttr.ready(
  function (twttr) {
    twttr.widgets.createTimeline({
      sourceType: 'profile',
      screenName: account
    },
    timeline,
    {
      tweetLimit: number,
      chrome: 'noheader, nofooter, noborders, transparent, noscrollbar',
      //screenName: 'ThisPlays2',
      showReplies: false
    }).then(function (el) {
      var style = document.getElementById('twitter-inject');

      // style.sheet.insertRule('body { --primary: #'+primary+'; --secundary: #'+secundary+'; }', 0);
      if(false && media === false) {
        console.log('test');
        console.log(style.sheet.rules);
        console.log(style.sheet.rules.length);
        addCSSRule(style.sheet,'body .timeline-Tweet-media','display: none;');
        // style.sheet.insertRule('body .timeline-Tweet-media { display: none; }', style.sheet.rules.length);
      }
      el.contentDocument.head.appendChild(style);
      timeline.classList.remove('hide');
      var list = el.contentDocument.querySelectorAll('.timeline-TweetList-tweet');
      console.log('yo1');
      for(var i=0; i<list.length; i++) {
        console.log(i,list[i],list.item(i));
        if(i) list.item(i).classList.add('hide');
      }
      console.log('yo2');
      setTimeout(function() {
        console.log('timeout');
        for(var i=0; i<list.length; i++) {
          list.item(i).classList.add('top');
        }
      },timer-100);
      console.log('yo3');
      var i=0;
      setInterval(function() {
        list.item(i++).classList.add('hide');
        if(i>list.length - 1) i=0;
        list.item(i).classList.remove('hide');
      },timer);
    });
  }
);
</script>
</body>
</html>
